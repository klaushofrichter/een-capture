rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ... other collection rules if any ...

    // Rules for the 'documents' collection
    match /documents/{documentId} {
      // Allow authenticated users to read or list documents
      // ONLY if the document's email matches their authenticated email.
      allow read, list: if request.auth != null && request.auth.token.email == "klaus@klaushofrichter.net";

      // Allow authenticated users to create documents
      // ONLY if the email in the new document matches their authenticated email.
      // This also prevents creating documents for other users.
      allow create: if request.auth != null && request.auth.token.email == "klaus@klaushofrichter.net";

      // Allow authenticated users to delete documents
      // ONLY if the document's email matches their authenticated email.
      allow delete: if request.auth != null && request.auth.token.email == "klaus@klaushofrichter.net";

      // Note: Your Cloud Function (getAllDocuments) uses the Admin SDK,
      // which bypasses these security rules. This allows the function
      // to read all documents regardless of the user's email, as intended.
    }
  }
}
